<!DOCTYPE html>
<meta charset="utf-8">
<!-- http://bl.ocks.org/mbostock/7341714 -->
<style>

.chart rect {
  fill: steelblue;
}
.chart .xline {
  stroke: blue;
}
.chart .yline {
  stroke: red;
}

.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}

.axis path,
.axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
}

.axis text {
    font-family: sans-serif;
    font-size: 11px;
    fill: black;
}
</style>
<svg class="chart"></svg>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var width = 600,
    height = 600,
    padding = 50;

var xScale = d3.scale.linear()
    .range([padding,width]);

var yScale = d3.scale.linear()
    .range([height-padding, 0]);

console.log("yscale "+6928961.115321899+"="+yScale(6928961.115321899));

var chart = d3.select(".chart")
    .attr("width", width)
    .attr("height", height);

d3.tsv("walk.tsv", type, function(error, data) {
  var tref = d3.min(data, function(d) { return d.time });
  xScale.domain(d3.extent(data, function(d) { return (d.time-tref)/1000; }));
  yScale.domain([d3.min(data, function(d) { return Math.min(d.y, d.x); }), d3.max(data, function(d) { return Math.max(d.y,d.x); })]);

  var bar = chart.selectAll("g")
      .data(data)
    .enter().append("g")	
      .attr("transform", function(d, i) { return "translate(" + xScale((d.time-tref)/1000) + "," + 0 + ")"; });

  bar.append("line")
      .classed('yline',true)
      .attr("x1", 0)
      .attr("x2", 0)
      .attr("y1", function(d) { return yScale(d.y-d.accuracy); })
      .attr("y2", function(d) { return yScale(d.y+d.accuracy); })
//      .attr("height", function(d) { console.log(""+(d.y-d.accuracy/2)+" - "+(d.y+d.accuracy/2)+" = "+yScale(d.y+d.accuracy/2)+" - "+yScale(d.y-d.accuracy/2)+" = "+(yScale(d.y+d.accuracy/2)-yScale(d.y-d.accuracy/2))); return yScale(d.y+d.accuracy/2)-yScale(d.y-d.accuracy/2); });

  bar.append("line")
      .classed('xline',true)
      .attr("x1", 0)
      .attr("x2", 0)
      .attr("y1", function(d) { return yScale(d.x-d.accuracy); })
      .attr("y2", function(d) { return yScale(d.x+d.accuracy); })

  var xAxis = d3.svg.axis()
                  .scale(xScale)
                  .orient("bottom");
  chart.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(0," + (height-padding) + ")")
      .call(xAxis);

  var yAxis = d3.svg.axis()
                  .scale(yScale)
                  .orient("left");
  chart.append("g")
      .attr("class", "axis")
      .attr("transform", "translate("+padding+",0)")
      .call(yAxis);

});

function type(d) {
  d.value = +d.value; // coerce to number
  return d;
}

</script>
